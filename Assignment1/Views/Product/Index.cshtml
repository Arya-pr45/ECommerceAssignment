@using ECommerce.Models.Products
@model IEnumerable<Product>

@{
	ViewData["Title"] = "All Products";
	var isAdmin = User.IsInRole("Admin");
}

<h2 class="mb-4">All Products</h2>

@if (isAdmin)
{
	<div class="d-flex justify-content-end mb-3">
		<a class="btn btn-success" asp-controller="Product" asp-action="Manage">
			<i class="bi bi-plus-circle-fill"></i> Add New Product
		</a>
	</div>
}

<div class="row row-cols-1 row-cols-md-3 g-4">
	@foreach (var product in Model)
	{
		<div class="col">
			<div class="card h-100 shadow-sm">

				@if (!string.IsNullOrEmpty(product.ImageUrl))
				{
					<img src="@product.ImageUrl" class="card-img-top" alt="@product.Name"
						 style="height: 200px; object-fit: cover;" />
				}
				else
				{
					<img src="/images/default-product.jpg" class="card-img-top" alt="Default Image"
						 style="height: 200px; object-fit: cover;" />
				}

				<div class="card-body">
					<h5 class="card-title">@product.Name</h5>
					<h6 class="card-subtitle mb-2 text-muted">Category: @product.Category</h6>
					<p class="card-text">Price: ₹@product.Price</p>

					@if (product.Stock <= 0)
					{
						<span class="badge bg-danger">Out of Stock</span>
					}
					else
					{
						<span class="badge bg-success">In Stock: @product.Stock</span>
					}
				</div>


				<div class="card-footer d-flex justify-content-between align-items-center">
					<a asp-action="Details" asp-route-id="@product.ProductId" class="btn btn-info btn-sm">View</a>

					@if (isAdmin)
					{
						<div class="d-flex">
							<form asp-controller="Product" asp-action="Manage" method="post" class="me-1">
								<input type="hidden" name="Action" value="M" />
								<input type="hidden" name="ProductId" value="@product.ProductId" />
								<input type="hidden" name="Name" value="@product.Name" />
								<input type="hidden" name="Price" value="@product.Price" />
								<input type="hidden" name="Category" value="@product.Category" />
								<input type="hidden" name="Description" value="@product.Description" />
								<input type="hidden" name="Stock" value="@product.Stock" />
								<input type="hidden" name="ImageUrl" value="@product.ImageUrl" />
								<button type="submit" class="btn btn-warning btn-sm">Edit</button>
							</form>

							<form asp-controller="Product" asp-action="SaveProduct" method="post">
								<input type="hidden" name="Action" value="D" />
								<input type="hidden" name="ProductId" value="@product.ProductId" />
								<input type="hidden" name="Name" value="@product.Name" />
								<input type="hidden" name="Price" value="@product.Price" />
								<input type="hidden" name="Category" value="@product.Category" />
								<input type="hidden" name="Description" value="@product.Description" />
								<input type="hidden" name="Stock" value="@product.Stock" />
								<input type="hidden" name="ImageUrl" value="@product.ImageUrl" />
								<button type="submit" class="btn btn-danger btn-sm">Delete</button>
							</form>
						</div>
					}
				</div>
			</div>
		</div>
	}
</div>
